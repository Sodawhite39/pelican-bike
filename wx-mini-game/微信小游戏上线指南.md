# 微信小游戏上线指南

## 一、上线前准备清单

### 1. 注册微信小游戏

1. 打开 [微信公众平台](https://mp.weixin.qq.com/)
2. 点击「立即注册」→ 选择「小程序」
3. 填写信息，选择「游戏」类目
4. 完成注册后，进入后台获取 **AppID**

### 2. 填入 AppID

打开 `wx-mini-game/project.config.json`，把空字符串替换为你的 AppID：

```json
{
  "appid": "wx1234567890abcdef",  ← 替换这里
  ...
}
```

### 3. 创建广告位

1. 登录微信公众平台 → 「流量主」→ 开通
2. 创建广告位：
   - **激励视频广告位**：用于「看广告复活」和「双倍距离」
   - **插屏广告位**：用于每 3 次死亡后展示
3. 获取 `adUnitId`

### 4. 填入广告 ID

打开 `wx-mini-game/src/ads/AdManager.ts`，替换占位 ID：

```typescript
const REWARDED_AD_ID = 'adunit-你的激励视频广告位ID';
const INTERSTITIAL_AD_ID = 'adunit-你的插屏广告位ID';
```

替换后重新构建：

```bash
cd wx-mini-game
bun run build
```

### 5. 微信开发者工具导入

1. 下载 [微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 选择「小游戏」项目
3. 导入 `wx-mini-game/` 目录
4. 填入你的 AppID
5. 点击「预览」→ 用手机扫码测试

### 6. 真机测试要点

- [ ] 触摸操控是否流畅（蹬车、刹车、倾斜、掉头）
- [ ] 音效是否正常播放（踩踏、风声、碰撞、结束音）
- [ ] 背景视差滚动是否正常
- [ ] 分享给好友功能是否正常
- [ ] 最高分是否正确保存和显示
- [ ] 广告是否能正常加载和播放（仅真机可测，模拟器不支持）
- [ ] 看广告复活功能是否正常
- [ ] 看广告双倍距离功能是否正常

### 7. 提交审核

1. 开发者工具 → 「上传」
2. 微信公众平台 → 「版本管理」→ 「提交审核」
3. 填写：
   - **版本描述**：物理平衡骑行小游戏，控制鹈鹕骑自行车保持平衡
   - **截图**：至少 2 张游戏截图（开发者工具可截图）
   - **录屏**：30 秒左右的游戏录屏
4. 审核通常 1-3 个工作日
5. 审核通过后 → 「发布」

---

## 二、变现方案

### 三条收入来源

#### 1. 激励视频广告（核心收入，占 60-70%）

已实现两个场景：

| 场景 | 转化率预估 | 说明 |
|------|----------|------|
| 看广告复活 | 35-50% | Game Over 后可看广告继续骑行，每局限 1 次 |
| 看广告双倍距离 | 20-30% | Game Over 结算时，观看广告距离 ×2 |

激励视频是 **eCPM 最高** 的广告形式，用户主动观看，体验损害最小。

#### 2. 插屏广告（占 20-30%）

- 每 3 次死亡后自动弹出一次插屏
- 不在游戏过程中打断
- 可在 `Game.ts` 中调整 `interstitialInterval` 改变频率

#### 3. 内购 IAP（未来扩展，占 10-20%）

预留了架构但本次未实现，未来可加入：
- 鹈鹕皮肤（不同颜色/装饰）
- 自行车皮肤
- 月卡（每日额外复活次数）

### 收入预期

| DAU（日活） | 月收入预估 |
|------------|----------|
| 1,000 | 500 - 1,500 元 |
| 10,000 | 5,000 - 15,000 元 |
| 50,000 | 25,000 - 75,000 元 |
| 100,000 | 50,000 - 150,000 元 |

> 关键指标：**次日留存率 > 30%** 的游戏才能稳定变现。

---

## 三、增长策略

### 社交裂变

游戏已内置分享功能：
- Game Over 界面「分享给好友」按钮
- 分享文案自带最高分：`🦩 我的鹈鹕骑了 XXX 米！你能超过吗？`
- 好友看到成绩 → 点开挑战 → 形成竞争循环

### 优化建议

1. **分享卡片配图**：制作一张吸引眼球的分享封面图，设置在 `wx.onShareAppMessage` 的 `imageUrl`
2. **排行榜**：接入微信开放数据域，显示好友排行（需额外开发）
3. **每日挑战**：每天随机生成一段特殊地形，所有人同一关卡竞争
4. **节日活动**：春节/国庆等节日换主题皮肤，短期拉活

### 冷启动

1. 分享到微信群和朋友圈
2. 小红书/抖音发游戏录屏
3. 利用微信「搜一搜」SEO（标题/描述含关键词）
4. 参加微信小游戏创意小游戏扶持计划

---

## 四、技术细节

### 构建流程

```bash
cd wx-mini-game
bun install          # 安装依赖（matter-js, esbuild, typescript）
bun run build        # 构建 → game.js (117KB, minified)
```

构建工具：esbuild，配置见 `build.mjs`：
- 格式：CommonJS（微信要求）
- 平台：neutral（非 browser/node）
- 目标：ES2017
- 生产环境自动压缩

### 项目配置

**game.json**：横屏模式

```json
{
  "deviceOrientation": "landscape",
  "showStatusBar": false
}
```

**project.config.json**：
- `packOptions.ignore` 排除了 `node_modules/`、`src/`、配置文件等
- 最终上传到微信的只有 `game.js` + `game.json` + `project.config.json`
- 总包体 < 120KB，远低于微信 4MB 限制

### 文件清单

| 文件 | 大小 | 说明 |
|------|------|------|
| game.js | 117KB | 主包（Matter.js + 全部游戏代码） |
| game.json | 0.1KB | 小游戏配置 |
| project.config.json | 0.5KB | 开发者工具配置 |
| **总计** | **~118KB** | 远低于 4MB 限制 |

---

## 五、后续迭代建议

| 优先级 | 功能 | 说明 |
|--------|------|------|
| P0 | 好友排行榜 | 接入微信开放数据域，显示好友排名 |
| P0 | 分享封面图 | 制作有吸引力的分享卡片配图 |
| P1 | 皮肤系统 | 不同鹈鹕/自行车样式，通过 IAP 或广告解锁 |
| P1 | 成就系统 | 骑行 100/500/1000 米解锁成就 |
| P2 | 每日挑战 | 固定种子地形，全服排名 |
| P2 | 道具系统 | 加速道具、护盾道具、弹簧道具 |
| P3 | 多人竞速 | 实时匹配对战（需服务端） |
